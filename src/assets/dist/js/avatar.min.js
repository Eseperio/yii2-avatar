"use strict";!function(t){jQuery.fn.yii2avatar=function(e){var a=t.extend({},{url:"/",attributeName:"avatar",i18n:{deleteMsg:"Are you sure you want to remove the avatar?"}},e);return{_el:null,init:function(t){this._el=t,this.attachEvents()},get:function(t){return this._el.find(t)},trigger:function(t){if("function"==typeof a[t]){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return a[t].apply(r)}return!0},attachEvents:function(){var t=this;this._el.on("change",'input[type="file"]',function(e){t.callback(e,"update")}),this._el.on("click",".remove-avatar",function(e){confirm(a.i18n.deleteMsg)&&t.callback(e,"delete")})},callback:function(e,r){console.log(this);var n=this,i=t(e.currentTarget);console.log(i);var o=new FormData;"update"==r&&o.append(a.attributeName,i[0].files[0]),a.avatarId&&o.append("avatarId",a.avatarId),t.ajax({url:a[r],data:o,type:"POST",contentType:!1,processData:!1,beforeSend:function(t,e){return n._el.addClass("loading"),n.trigger("beforeUpload")}}).done(function(t,e,a){if(t.success){if(n.trigger("afterUpload",t,e,a)){var r=n.get(".avatar-image"),i=r.attr("src"),o="?";i.indexOf("?")&&(o="&");var l=i+o+Math.random();r.attr("src",l+"?"+Math.random())}}else n.trigger("onFail",t,e,a)&&alert(t.error);n._el.removeClass("loading")}).fail(function(t,e,a){n.trigger("onAjaxFail",t,e,a)&&(n._el.removeClass("loading"),alert("A problem ocurred updating your profile picture"))})}}.init(this),this}}(jQuery);